# axo_skimming
This code skims CMS Scouting NanoAODs down to smaller filesizes via a condor batch system. The code in `skim.cxx` filters for events which pass the AXOL1TL or ZeroBias HLT triggers, it also removes unused branches such as the ScoutingPFCandidates and ScoutingTracks.

## Setup instructions
This setup can be run from any HTCondor cluster, e.g. on lxplus. 

To setup the environment use CMSSW_14_0_15. 
```
ssh YOUR_USERNAME@lxplus.cern.ch 
source /cvmfs/cms.cern.ch/cmsset_default.sh
cmsrel CMSSW_14_0_15
cd CMSSW_14_0_15/src/
cmsenv
git clone git@github.com:ekauffma/axo_skimming.git
cd axo_skimming
git clone https://gitlab.cern.ch/cms-l1-ad/axol1tl-producer.git
git clone https://gitlab.cern.ch/ssummers/run3_ugt_ml
cd run3_ugt_ml 
pip3 install . 
cd ..
voms-proxy-init -voms cms

```

Before running, you *must* change the output, error, log and transfer input file paths in `scriptcondor_skimming_template.sub`.
You *must* also change the output directory in `scriptcondor_skimming.sh`.

To run a local test run `. scriptcondor_skimming.sh root://hip-cms-se.csc.fi:///store/user/pinkaew/scouting_nano_prod_v0p1_golden/ScoutingPFRun3/crab_ScoutingPFRun3_Run2024F-v1_381946-382300_Golden/240729_151406/0000/scouting_nano_10.root test.root`. This should copy the output to the directory defined in `scriptcondor_skimming.sh`.

To run a test on condor with a single file run `sh submit.sh input_onefile.txt`. Once the indiviudal test has finished (check status with `condor_q`) you can look at the output directory and check that that logs look okay. 

Once the individual test has passed you can run on a larger set of files with `sh submit.sh input_\*.txt` where `input\*.txt` contains a list of files you want to run over. This file can be generated by running, editing `check_xrootd.py` and changing the directory path to the dataset you want to run on. `check_xrootd.py > input_new.txt` will save a new set of input files for you. To check that your jobs have completed successfully you can run `. examine_condor_dirs.sh`. 
